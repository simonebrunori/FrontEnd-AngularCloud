jvm.DataSeries=function(params,elements,map){var scaleConstructor;params=params||{};params.attribute=params.attribute||'fill';this.elements=elements;this.params=params;this.map=map;if(params.attributes){this.setAttributes(params.attributes);}
if(jvm.$.isArray(params.scale)){scaleConstructor=(params.attribute==='fill'||params.attribute==='stroke')?jvm.ColorScale:jvm.NumericScale;this.scale=new scaleConstructor(params.scale,params.normalizeFunction,params.min,params.max);}else if(params.scale){this.scale=new jvm.OrdinalScale(params.scale);}else{this.scale=new jvm.SimpleScale(params.scale);}
this.values=params.values||{};this.setValues(this.values);if(this.params.legend){this.legend=new jvm.Legend($.extend({map:this.map,series:this},this.params.legend))}};jvm.DataSeries.prototype={setAttributes:function(key,attr){var attrs=key,code;if(typeof key=='string'){if(this.elements[key]){this.elements[key].setStyle(this.params.attribute,attr);}}else{for(code in attrs){if(this.elements[code]){this.elements[code].element.setStyle(this.params.attribute,attrs[code]);}}}},setValues:function(values){var max=-Number.MAX_VALUE,min=Number.MAX_VALUE,val,cc,attrs={};if(!(this.scale instanceof jvm.OrdinalScale)&&!(this.scale instanceof jvm.SimpleScale)){if(typeof this.params.min==='undefined'||typeof this.params.max==='undefined'){for(cc in values){val=parseFloat(values[cc]);if(val>max)max=val;if(val<min)min=val;}}
if(typeof this.params.min==='undefined'){this.scale.setMin(min);this.params.min=min;}else{this.scale.setMin(this.params.min);}
if(typeof this.params.max==='undefined'){this.scale.setMax(max);this.params.max=max;}else{this.scale.setMax(this.params.max);}
for(cc in values){if(cc!='indexOf'){val=parseFloat(values[cc]);if(!isNaN(val)){attrs[cc]=this.scale.getValue(val);}else{attrs[cc]=this.elements[cc].element.style.initial[this.params.attribute];}}}}else{for(cc in values){if(values[cc]){attrs[cc]=this.scale.getValue(values[cc]);}else{attrs[cc]=this.elements[cc].element.style.initial[this.params.attribute];}}}
this.setAttributes(attrs);jvm.$.extend(this.values,values);},clear:function(){var key,attrs={};for(key in this.values){if(this.elements[key]){attrs[key]=this.elements[key].element.shape.style.initial[this.params.attribute];}}
this.setAttributes(attrs);this.values={};},setScale:function(scale){this.scale.setScale(scale);if(this.values){this.setValues(this.values);}},setNormalizeFunction:function(f){this.scale.setNormalizeFunction(f);if(this.values){this.setValues(this.values);}}};